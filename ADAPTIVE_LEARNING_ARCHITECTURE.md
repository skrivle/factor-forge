# Adaptive Learning System - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER PLAYS GAME                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GameArena Component                               â”‚
â”‚  â€¢ Tracks each question answered                                     â”‚
â”‚  â€¢ Records: answer, correctness, time taken                          â”‚
â”‚  â€¢ Collects all data during session                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Game Ends â†’ onGameEnd()                          â”‚
â”‚  â€¢ Score, accuracy, questions, answers                               â”‚
â”‚  â€¢ isCorrectAnswers[], timeTaken[]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  POST /api/game/save                                 â”‚
â”‚  â€¢ Saves session summary                                             â”‚
â”‚  â€¢ Calls saveQuestionStats()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Database: question_stats                            â”‚
â”‚  â€¢ Stores individual question performance                            â”‚
â”‚  â€¢ Links to user_id and session_id                                   â”‚
â”‚  â€¢ Fields: num1, num2, operation, is_correct, time_taken             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Analysis & Aggregation                             â”‚
â”‚  â€¢ View: user_weak_questions                                         â”‚
â”‚  â€¢ Groups by (user_id, num1, num2, operation)                        â”‚
â”‚  â€¢ Calculates: accuracy_rate, times_incorrect                        â”‚
â”‚  â€¢ Filters: questions seen >= 2 times                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USER CLICKS "SLIMME OEFENING" ğŸ¯                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GET /api/practice/weak-questions                       â”‚
â”‚  â€¢ Fetches weak questions for user                                   â”‚
â”‚  â€¢ Returns: weakQuestions[], hasEnoughData                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                        â”‚             â”‚
                 hasEnoughData?       â”‚
                        â”‚             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
            â”‚           â”‚        â”‚    â”‚
           NO          YES       â”‚    â”‚
            â”‚           â”‚        â”‚    â”‚
            â–¼           â–¼        â”‚    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
    â”‚ Show     â”‚  â”‚ Generate â”‚  â”‚    â”‚
    â”‚ "Need    â”‚  â”‚ Adaptive â”‚  â”‚    â”‚
    â”‚ More     â”‚  â”‚ Questionsâ”‚  â”‚    â”‚
    â”‚ Data"    â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚    â”‚
    â”‚ Message  â”‚        â”‚        â”‚    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚        â”‚    â”‚
                        â–¼        â”‚    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ generateAdaptiveQuestions()   â”‚
            â”‚                               â”‚
            â”‚ Weight Assignment:            â”‚
            â”‚  â€¢ <50% accuracy  = 10x       â”‚
            â”‚  â€¢ 50-75% accuracy = 5x       â”‚
            â”‚  â€¢ 75-90% accuracy = 3x       â”‚
            â”‚  â€¢ >90% accuracy  = 1x        â”‚
            â”‚                               â”‚
            â”‚ Mix: 70% weak + 30% random    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Practice Session    â”‚
            â”‚  (GameArena)         â”‚
            â”‚  â€¢ Uses weighted     â”‚
            â”‚    question pool     â”‚
            â”‚  â€¢ Same game UX      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Save Results        â”‚
            â”‚  (back to top)       â”‚
            â”‚  â€¢ Updates stats     â”‚
            â”‚  â€¢ Refines analysis  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Continuous          â”‚
            â”‚  Improvement Loop    â”‚
            â”‚  â€¢ User gets better  â”‚
            â”‚  â€¢ Weights adjust    â”‚
            â”‚  â€¢ New weak areas    â”‚
            â”‚    identified        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Example

### Example 1: User Struggles with 3Ã—8

```
Session 1: 3Ã—8 = ?
â”œâ”€> User answers: 21 (wrong)
â”œâ”€> Saves: is_correct=false, time_taken=4.5s
â””â”€> question_stats: { 3, 8, multiplication, false }

Session 2: 3Ã—8 = ?
â”œâ”€> User answers: 23 (wrong)
â”œâ”€> Saves: is_correct=false, time_taken=5.2s
â””â”€> question_stats: { 3, 8, multiplication, false }

Session 3: 3Ã—8 = ?
â”œâ”€> User answers: 24 (correct!)
â”œâ”€> Saves: is_correct=true, time_taken=3.1s
â””â”€> question_stats: { 3, 8, multiplication, true }

Analysis:
â”œâ”€> times_seen: 3
â”œâ”€> times_incorrect: 2
â”œâ”€> accuracy_rate: 0.33 (33%)
â””â”€> WEIGHT: 10x (high priority for practice!)

Practice Session:
â”œâ”€> 3Ã—8 appears ~7 times out of 20 questions
â”œâ”€> User practices intensively
â””â”€> Accuracy improves â†’ weight decreases
```

### Example 2: User Masters 2Ã—5

```
Sessions 1-5: 2Ã—5 = ?
â”œâ”€> All correct
â”œâ”€> Average time: 1.8s
â””â”€> accuracy_rate: 1.00 (100%)

Analysis:
â”œâ”€> times_seen: 5
â”œâ”€> times_incorrect: 0
â”œâ”€> accuracy_rate: 1.00
â””â”€> WEIGHT: 1x (occasional review only)

Practice Session:
â”œâ”€> 2Ã—5 appears ~1 time out of 20 questions
â”œâ”€> Just for maintenance
â””â”€> Focus stays on harder questions
```

## Database Schema Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚â—„â”€â”€â”€â”
â”‚ name                 â”‚    â”‚
â”‚ pin                  â”‚    â”‚
â”‚ role                 â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     sessions         â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ id (PK)              â”‚â—„â”€â”€â”€â”¼â”€â”€â”€â”
â”‚ user_id (FK)         â”‚â”€â”€â”€â”€â”˜   â”‚
â”‚ score                â”‚        â”‚
â”‚ accuracy             â”‚        â”‚
â”‚ completed_at         â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
â”‚     question_stats            â”‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ id (PK)                       â”‚    â”‚
â”‚ user_id (FK)                  â”‚â”€â”€â”€â”€â”˜
â”‚ session_id (FK)               â”‚â”€â”€â”€â”€â”˜
â”‚ num1                          â”‚
â”‚ num2                          â”‚
â”‚ operation                     â”‚
â”‚ correct_answer                â”‚
â”‚ user_answer                   â”‚
â”‚ is_correct                    â”‚
â”‚ time_taken                    â”‚
â”‚ created_at                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ (aggregated by)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  user_weak_questions (VIEW)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id                      â”‚
â”‚ num1                         â”‚
â”‚ num2                         â”‚
â”‚ operation                    â”‚
â”‚ times_seen                   â”‚
â”‚ times_incorrect              â”‚
â”‚ accuracy_rate                â”‚
â”‚ avg_time_taken               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Code Flow

### 1. During Game
```typescript
GameArena.tsx:
  handleAnswer(answer) â†’
    â€¢ Calculate timeTaken
    â€¢ Update userAnswers[i]
    â€¢ Update isCorrectAnswers[i]
    â€¢ Update timeTaken[i]
    â€¢ Move to next question

  onGameEnd() â†’
    â€¢ Return all collected data
    â€¢ { questions, userAnswers, isCorrectAnswers, timeTaken }
```

### 2. Saving Results
```typescript
/api/game/save:
  â€¢ Save session summary
  â€¢ Call saveQuestionStats(userId, sessionId, details)
  
lib/db/queries.ts:
  saveQuestionStats() â†’
    â€¢ Loop through all questions
    â€¢ Insert into question_stats
    â€¢ One row per question
```

### 3. Practice Mode
```typescript
/practice page:
  â€¢ Fetch weak questions via API
  â€¢ Generate adaptive questions
  â€¢ Start GameArena with preGeneratedQuestions

lib/game/engine.ts:
  generateAdaptiveQuestions(config, weakQuestions) â†’
    â€¢ Calculate weights per question
    â€¢ Build weighted pool
    â€¢ Mix 70% weak + 30% random
    â€¢ Shuffle and return
```

## Performance Considerations

- **Indexes**: Added on (user_id, num1, num2, operation)
- **Batch Inserts**: All questions saved in one transaction
- **View Caching**: Aggregation happens at query time
- **Lazy Loading**: Weak questions fetched only when needed

## Security

- All endpoints check authentication
- User can only access own question stats
- Database queries use parameterized statements
- No sensitive data exposed in responses
